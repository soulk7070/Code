# =================================================================
# ðŸš€ Jalankan ulang ComfyUI + Cloudflare Tunnel di Colab
# =================================================================

import subprocess, os, signal, time

# ðŸ”‘ Ganti token ini dengan Cloudflare Tunnel Token yang BENAR
CLOUDFLARE_TUNNEL_TOKEN = "MASUKKAN_TOKEN_TUNNEL_ANDA_DI_SINI"

# Hentikan proses lama (kalau masih ada)
!pkill -f cloudflared || echo "tidak ada cloudflared lama"
!pkill -f "python main.py" || echo "tidak ada comfyui lama"

# Jalankan ComfyUI di background
comfy_cmd = "python /content/comfyui/main.py --listen 0.0.0.0 --port 8188"
comfy_proc = subprocess.Popen(comfy_cmd.split(), stdout=open("/content/comfyui.log","w"), stderr=subprocess.STDOUT)

time.sleep(10)  # tunggu beberapa detik biar ComfyUI siap

# Jalankan Cloudflare Tunnel
cloudflare_cmd = f"./cloudflared-linux-amd64 tunnel --no-autoupdate run --token {CLOUDFLARE_TUNNEL_TOKEN}"
cloudflare_proc = subprocess.Popen(cloudflare_cmd.split(), stdout=open("/content/cloudflared.log","w"), stderr=subprocess.STDOUT)

print("âœ… ComfyUI & Cloudflare Tunnel dijalankan ulang")
print("ðŸ“œ Log ComfyUI: /content/comfyui.log")
print("ðŸ“œ Log Cloudflare: /content/cloudflared.log")
